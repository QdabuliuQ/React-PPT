import { fabric } from 'fabric'

import { getRandomID, initElement } from '@/utils'

const ICON =
  '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1726043568130" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2365" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M731.640907 601.310072c-8.209986 0-16.423041-3.134387-22.689768-9.402137-12.537548-12.524245-12.537548-32.855292 0-45.381583l131.838677-131.840724c32.333406-32.333406 50.14712-75.312266 50.14712-121.027447s-17.813714-88.694041-50.14712-121.017214c-32.332383-32.343639-75.311243-50.145074-121.027447-50.145074l-0.010233 0c-45.716204 0-88.684832 17.801435-121.006981 50.134841L466.894198 304.471456c-12.536524 12.535501-32.846082 12.535501-45.381583 0-12.536524-12.526291-12.536524-32.855292 0-45.381583l131.839701-131.839701c44.442188-44.452421 103.540168-68.940139 166.399821-68.940139 0.010233 0 0 0 0.010233 0 62.859653 0 121.958656 24.487717 166.409031 68.940139 44.462654 44.441165 68.950372 103.550401 68.950372 166.409031 0 62.859653-24.487717 121.967866-68.950372 166.419264L754.329652 591.908958C748.062925 598.175685 739.851916 601.310072 731.640907 601.310072z" p-id="2366"></path><path d="M299.871183 948.919001c-62.868863 0-121.978099-24.485671-166.43052-68.948325-91.745541-91.756797-91.745541-241.065358 0-332.839551l131.872446-131.841747c12.536524-12.535501 32.866548-12.535501 45.381583 0 12.535501 12.536524 12.535501 32.855292 0 45.381583L178.833503 592.512708c-66.724681 66.745147-66.724681 175.340447 0 242.075361 32.333406 32.333406 75.312266 50.146097 121.03768 50.146097 45.727461 0 88.705298-17.812691 121.027447-50.146097l131.85198-131.839701c12.536524-12.535501 32.844036-12.535501 45.381583 0 12.536524 12.527314 12.536524 32.855292 0 45.38056l-131.840724 131.842771C421.849282 924.43333 362.740046 948.919001 299.871183 948.919001z" p-id="2367"></path><path d="M316.477396 729.038128c-8.212032 0-16.423041-3.134387-22.691815-9.402137-12.535501-12.535501-12.535501-32.854269 0-45.381583l344.395748-344.373235c12.535501-12.535501 32.844036-12.535501 45.38056 0 12.536524 12.536524 12.536524 32.856315 0 45.382607l-344.393701 344.372212C332.898391 725.903741 324.687382 729.038128 316.477396 729.038128z" p-id="2368"></path></svg>'

interface Link extends Partial<fabric.Textbox> {
  url: string
  [propName: string]: any
}

function linkClickEvent(this: any) {
  console.log(this)
}

function createElement(text: string, url: string, option: Partial<Link> = {}) {
  const link = new fabric.Textbox(option.text || '', {
    property: {
      id: getRandomID(10),
      type: 'link',
      url
    },
    text,
    hoverCursor: 'pointer',
    ...option
  } as { [propName: string]: any })

  initElement(link)
  link.on('mouse:down', linkClickEvent)

  return link
}

const info = {
  title: '超链接',
  icon: ICON
}

export default {
  createElement,
  info
}
